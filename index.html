<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>TABELA DE HORÁRIOS MODERNA</title>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>

  <!-- HTML2PDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

  <style>
    body { font-family: 'Arial Black', Arial, sans-serif; background: #f0f0f0; text-transform: uppercase; padding: 10px; font-size: 12px; }
    h1 { text-align: center; font-size: 20px; color: #222; }
    .turno { border-radius: 5px; padding: 10px; margin-bottom: 10px; background: white; }
    .turno h2 { font-size: 14px; font-weight: bold; }
    .separador { border-left: 10px solid #ff7043; background-color: #ffe0b2; }
    .donoderua { border-left: 10px solid #ffca28; background-color: #fff9c4; }
    .checkout { border-left: 10px solid #66bb6a; background-color: #c8e6c9; }
    .empilhadores { border-left: 10px solid #29b6f6; background-color: #b3e5fc; }
    .funcionario input { padding: 6px; border-radius: 4px; border: 1px solid #ccc; flex: 1; text-transform: uppercase; font-family: 'Arial Black'; }
    .funcionario { display: flex; align-items: center; margin-bottom: 8px; }
    .funcionario button { margin-left: 8px; background: #e53935; color: white; border: none; padding: 6px 10px; border-radius: 4px; cursor: pointer; }
    .data-horario input { margin: 5px 10px 10px 0; padding: 8px; border-radius: 5px; border: 1px solid #ccc; text-transform: uppercase; }
    #controles { margin-bottom: 20px; display: flex; gap: 10px; flex-wrap: wrap; }
    #controles input, #controles select { padding: 8px; border-radius: 5px; border: 1px solid #ccc; text-transform: uppercase; }
    #controles button { background: #0288d1; color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer; }
    #logoPDF { display: none; }
  </style>
</head>
<body>

<!-- LOGO oculta para ser inserida no PDF -->
<img id="logoPDF" src="LOGO_DURÃES_VETORIZADA.png" alt="LOGO DURÃES" width="200">

<h1>TABELA DE HORÁRIOS</h1>

<div id="login">
  <input type="email" id="email" placeholder="EMAIL">
  <input type="password" id="senha" placeholder="SENHA">
  <button onclick="login()">ENTRAR</button>
  <button onclick="logout()" style="display:none;" id="logoutBtn">SAIR</button>
</div>

<div id="controles">
  <input type="text" id="nomeNovo" placeholder="NOME">
  <select id="setorNovo">
    <option value="separador1">SEPARADOR 1º TURNO</option>
    <option value="separador2">SEPARADOR 2º TURNO</option>
    <option value="donoderua1">DONO DE RUA 1º TURNO</option>
    <option value="donoderua2">DONO DE RUA 2º TURNO</option>
    <option value="checkout1">CHECKOUT 1º TURNO</option>
    <option value="checkout2">CHECKOUT 2º TURNO</option>
    <option value="empilhadores">EMPILHADORES</option>
  </select>
  <button onclick="adicionarFuncionario()">ADICIONAR</button>
  <button onclick="gerarPDF()">PDF</button>
  <button onclick="salvarDados()">SALVAR</button>
</div>

<div class="turno separador" id="separador1"><h2>SEPARADOR - 1º TURNO</h2><div class="data-horario"><input placeholder="DATA" class="dataInput"><input placeholder="HORÁRIO" class="horarioInput"></div></div>
<div class="turno separador" id="separador2"><h2>SEPARADOR - 2º TURNO</h2><div class="data-horario"><input placeholder="DATA" class="dataInput"><input placeholder="HORÁRIO" class="horarioInput"></div></div>
<div class="turno donoderua" id="donoderua1"><h2>DONO DE RUA - 1º TURNO</h2><div class="data-horario"><input placeholder="DATA" class="dataInput"><input placeholder="HORÁRIO" class="horarioInput"></div></div>
<div class="turno donoderua" id="donoderua2"><h2>DONO DE RUA - 2º TURNO</h2><div class="data-horario"><input placeholder="DATA" class="dataInput"><input placeholder="HORÁRIO" class="horarioInput"></div></div>
<div class="turno checkout" id="checkout1"><h2>CHECKOUT - 1º TURNO</h2><div class="data-horario"><input placeholder="DATA" class="dataInput"><input placeholder="HORÁRIO" class="horarioInput"></div></div>
<div class="turno checkout" id="checkout2"><h2>CHECKOUT - 2º TURNO</h2><div class="data-horario"><input placeholder="DATA" class="dataInput"><input placeholder="HORÁRIO" class="horarioInput"></div></div>
<div class="turno empilhadores" id="empilhadores"><h2>EMPILHADORES</h2><div class="data-horario"><input placeholder="DATA" class="dataInput"><input placeholder="HORÁRIO" class="horarioInput"></div></div>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyAvtcqhy-bj1iOpBVcIPBjvNfYygjHSpAY",
    authDomain: "horarios-duraes.firebaseapp.com",
    projectId: "horarios-duraes",
    storageBucket: "horarios-duraes.firebasestorage.app",
    messagingSenderId: "801770957942",
    appId: "1:801770957942:web:ce5d664d7f084281ac4357"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
  const auth = firebase.auth();

  function criarFuncionario(nome, setor) {
    const div = document.createElement('div');
    div.className = 'funcionario';
    const input = document.createElement('input');
    input.value = nome;
    const btn = document.createElement('button');
    btn.textContent = 'X';
    btn.onclick = () => div.remove();
    div.appendChild(input);
    div.appendChild(btn);
    document.getElementById(setor).appendChild(div);
  }

  function adicionarFuncionario() {
    const nome = document.getElementById('nomeNovo').value.trim();
    const setor = document.getElementById('setorNovo').value;
    if (nome) { criarFuncionario(nome, setor); document.getElementById('nomeNovo').value = ''; }
  }

  function gerarPDF() {
    const clone = document.body.cloneNode(true);

    // Remove login e cadastro
    const loginDiv = clone.querySelector('#login');
    if (loginDiv) loginDiv.remove();
    const controlesDiv = clone.querySelector('#controles');
    if (controlesDiv) controlesDiv.remove();

    // Insere logo no topo
    const logo = document.getElementById('logoPDF').cloneNode();
    logo.style.display = 'block';
    clone.insertBefore(logo, clone.firstChild);

    const opt = {
      margin: 5,
      filename: 'tabela_horarios_' + new Date().toISOString().slice(0,10) + '.pdf',
      image: { type: 'jpeg', quality: 0.98 },
      html2canvas: { scale: 2 },
      jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
    };
    html2pdf().set(opt).from(clone).save();
  }

  function salvarDados() {
    if (!auth.currentUser) {
      alert('FAÇA LOGIN PARA SALVAR');
      return;
    }
    const dados = {};
    document.querySelectorAll('.turno').forEach(turno => {
      const id = turno.id;
      const data = turno.querySelector('.dataInput').value;
      const horario = turno.querySelector('.horarioInput').value;
      dados[id] = { data, horario, funcionarios: [] };
      turno.querySelectorAll('.funcionario input').forEach(f => dados[id].funcionarios.push(f.value));
    });
    db.collection("tabela").doc("horarios").set(dados).then(() => alert("DADOS SALVOS NO FIREBASE"));
  }

  window.onload = () => {
    db.collection("tabela").doc("horarios").get().then(doc => {
      if (doc.exists) {
        const dados = doc.data();
        for (let setor in dados) {
          const div = document.getElementById(setor);
          div.querySelector('.dataInput').value = dados[setor].data;
          div.querySelector('.horarioInput').value = dados[setor].horario;
          dados[setor].funcionarios.forEach(nome => criarFuncionario(nome, setor));
        }
      }
    });
  }

  function login() {
    const email = document.getElementById('email').value;
    const senha = document.getElementById('senha').value;
    auth.signInWithEmailAndPassword(email, senha)
      .then(() => {
        alert('LOGIN EFETUADO');
        document.getElementById('logoutBtn').style.display = 'inline';
      })
      .catch(e => alert('ERRO: ' + e.message));
  }

  function logout() {
    auth.signOut().then(() => {
      alert('DESLOGADO');
      document.getElementById('logoutBtn').style.display = 'none';
    });
  }
</script>

</body>
</html>
