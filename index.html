<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>TABELA DE HORÁRIOS MODERNA</title>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

  <!-- HTML2PDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

  <style>
    body { font-family: 'Arial Black', Arial, sans-serif; background: #f0f0f0; text-transform: uppercase; padding: 10px; font-size: 12px; }
    h1 { text-align: center; font-size: 20px; color: #222; }
    .turno { border-radius: 5px; padding: 10px; margin-bottom: 10px; background: white; }
    .turno h2 { font-size: 14px; font-weight: bold; }
    .separador { border-left: 10px solid #ff7043; background-color: #ffe0b2; }
    .donoderua { border-left: 10px solid #ffca28; background-color: #fff9c4; }
    .checkout { border-left: 10px solid #66bb6a; background-color: #c8e6c9; }
    .empilhadores { border-left: 10px solid #29b6f6; background-color: #b3e5fc; }
    .funcionario { display: flex; align-items: center; margin-bottom: 8px; }
    .funcionario input { padding: 6px; border-radius: 4px; border: 1px solid #ccc; flex: 1; }
    .funcionario button { margin-left: 5px; background: #ccc; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; }
    .data-horario input { margin: 5px 10px 10px 0; padding: 8px; border-radius: 5px; border: 1px solid #ccc; }
    #controles { margin-bottom: 20px; display: flex; gap: 10px; flex-wrap: wrap; }
    #controles input, #controles select { padding: 8px; border-radius: 5px; border: 1px solid #ccc; }
    #controles button { background: #0288d1; color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer; }
    #logoPDF { display: none; }
    .turno-empilhador { font-size: 10px; margin-left: 5px; color: #555; }
  </style>
</head>
<body>

<img id="logoPDF" src="LOGO_DURÃES_VETORIZADA.png" alt="LOGO DURÃES" width="200">

<h1>TABELA DE HORÁRIOS</h1>

<div id="controles">
  <input type="text" id="nomeNovo" placeholder="NOME">
  <select id="setorNovo">
    <option value="separador1">SEPARADOR 1º TURNO</option>
    <option value="separador2">SEPARADOR 2º TURNO</option>
    <option value="donoderua1">DONO DE RUA 1º TURNO</option>
    <option value="donoderua2">DONO DE RUA 2º TURNO</option>
    <option value="checkout1">CHECKOUT 1º TURNO</option>
    <option value="checkout2">CHECKOUT 2º TURNO</option>
    <option value="empilhadores">EMPILHADORES</option>
  </select>
  <button onclick="adicionarFuncionario()">ADICIONAR</button>
  <button onclick="gerarPDF()">PDF</button>
  <button onclick="salvarDados()">SALVAR</button>
</div>

<div class="turno separador" id="separador1"><h2>SEPARADOR - 1º TURNO</h2><div class="data-horario"><input placeholder="DATA"><input placeholder="HORÁRIO"></div></div>
<div class="turno separador" id="separador2"><h2>SEPARADOR - 2º TURNO</h2><div class="data-horario"><input placeholder="DATA"><input placeholder="HORÁRIO"></div></div>
<div class="turno donoderua" id="donoderua1"><h2>DONO DE RUA - 1º TURNO</h2><div class="data-horario"><input placeholder="DATA"><input placeholder="HORÁRIO"></div></div>
<div class="turno donoderua" id="donoderua2"><h2>DONO DE RUA - 2º TURNO</h2><div class="data-horario"><input placeholder="DATA"><input placeholder="HORÁRIO"></div></div>
<div class="turno checkout" id="checkout1"><h2>CHECKOUT - 1º TURNO</h2><div class="data-horario"><input placeholder="DATA"><input placeholder="HORÁRIO"></div></div>
<div class="turno checkout" id="checkout2"><h2>CHECKOUT - 2º TURNO</h2><div class="data-horario"><input placeholder="DATA"><input placeholder="HORÁRIO"></div></div>
<div class="turno empilhadores" id="empilhadores"><h2>EMPILHADORES</h2><div class="data-horario"><input placeholder="DATA"><input placeholder="HORÁRIO"></div></div>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyAvtcqhy-bj1iOpBVcIPBjvNfYygjHSpAY",
    authDomain: "horarios-duraes.firebaseapp.com",
    projectId: "horarios-duraes",
    storageBucket: "horarios-duraes.firebasestorage.app",
    messagingSenderId: "801770957942",
    appId: "1:801770957942:web:ce5d664d7f084281ac4357"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  function criarFuncionario(nome, setor, turno=1) {
    const div = document.createElement('div');
    div.className = 'funcionario';
    const input = document.createElement('input');
    input.value = nome;

    const turnoSpan = document.createElement('span');
    turnoSpan.className = 'turno-empilhador';
    turnoSpan.textContent = setor === 'empilhadores' ? `(${turno}º TURNO)` : '';

    const btnTroca = document.createElement('button');
    btnTroca.textContent = '⇄';
    btnTroca.onclick = () => moverFuncionario(div, setor, turnoSpan);

    const btnExcluir = document.createElement('button');
    btnExcluir.textContent = 'X';
    btnExcluir.onclick = () => {
      if (confirm('Tem certeza que deseja excluir este funcionário?')) {
        div.remove();
      }
    };

    div.appendChild(input);
    div.appendChild(turnoSpan);
    div.appendChild(btnTroca);
    div.appendChild(btnExcluir);
    document.getElementById(setor).appendChild(div);

    ordenarFuncionarios(setor);
  }

  function adicionarFuncionario() {
    const nome = document.getElementById('nomeNovo').value.trim();
    const setor = document.getElementById('setorNovo').value;
    if (nome) { 
      criarFuncionario(nome, setor);
      document.getElementById('nomeNovo').value = ''; 
    }
  }

  function moverFuncionario(funcDiv, setor, turnoSpan) {
    if (setor === 'empilhadores') {
      let turnoAtual = parseInt(turnoSpan.textContent[1]);
      turnoAtual = turnoAtual % 3 + 1;
      turnoSpan.textContent = `(${turnoAtual}º TURNO)`;
    } else {
      const parent = funcDiv.parentElement.id;
      let proximo = '';
      if (parent.includes('separador')) {
        proximo = parent === 'separador1' ? 'separador2' : 'separador1';
      } else if (parent.includes('donoderua')) {
        proximo = parent === 'donoderua1' ? 'donoderua2' : 'donoderua1';
      } else if (parent.includes('checkout')) {
        proximo = parent === 'checkout1' ? 'checkout2' : 'checkout1';
      }
      document.getElementById(proximo).appendChild(funcDiv);
      ordenarFuncionarios(proximo);
    }
    if (setor === 'empilhadores') ordenarFuncionarios(setor);
  }

  function ordenarFuncionarios(setor) {
    const container = document.getElementById(setor);
    const funcionarios = Array.from(container.querySelectorAll('.funcionario'));
    funcionarios.sort((a, b) => a.querySelector('input').value.localeCompare(b.querySelector('input').value));
    funcionarios.forEach(f => container.appendChild(f));
  }

  function gerarPDF() {
    const clone = document.body.cloneNode(true);
    const controlesDiv = clone.querySelector('#controles');
    if (controlesDiv) controlesDiv.remove();

    clone.querySelectorAll('.funcionario button').forEach(btn => btn.remove());
    clone.querySelectorAll('.turno-empilhador').forEach(span => span.remove());

    const logo = document.getElementById('logoPDF').cloneNode();
    logo.style.display = 'block';
    clone.insertBefore(logo, clone.firstChild);

    const opt = {
      margin: 5,
      filename: 'tabela_horarios_' + new Date().toISOString().slice(0,10) + '.pdf',
      image: { type: 'jpeg', quality: 0.98 },
      html2canvas: { scale: 2 },
      jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
    };
    html2pdf().set(opt).from(clone).save();
  }

  function salvarDados() {
    const dados = {};
    document.querySelectorAll('.turno').forEach(turno => {
      const id = turno.id;
      const data = turno.querySelector('.data-horario input').value;
      const horario = turno.querySelector('.data-horario input:nth-child(2)').value;
      dados[id] = { data, horario, funcionarios: [] };
      turno.querySelectorAll('.funcionario').forEach(f => {
        const nome = f.querySelector('input').value;
        const turnoEmp = f.querySelector('.turno-empilhador');
        const turnoTexto = turnoEmp ? turnoEmp.textContent : '';
        dados[id].funcionarios.push(nome + turnoTexto);
      });
    });
    db.collection("tabela").doc("horarios").set(dados).then(() => alert("DADOS SALVOS NO FIREBASE"));
  }

  window.onload = () => {
    db.collection("tabela").doc("horarios").get().then(doc => {
      if (doc.exists) {
        const dados = doc.data();
        for (let setor in dados) {
          const div = document.getElementById(setor);
          div.querySelector('.data-horario input').value = dados[setor].data;
          div.querySelector('.data-horario input:nth-child(2)').value = dados[setor].horario;
          dados[setor].funcionarios.forEach(nomeTurno => {
            const [nome, turnoTexto] = nomeTurno.split('(');
            const turnoNum = turnoTexto ? parseInt(turnoTexto[0]) : 1;
            criarFuncionario(nome.trim(), setor, setor === 'empilhadores' ? turnoNum : 1);
          });
        }
      }
    });
  }
</script>

</body>
</html>
